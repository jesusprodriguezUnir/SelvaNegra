
<!-- HTML para el widget del tiempo -->
<div class="weather-widget" id="weather-widget">
    <h3><i class="fas fa-cloud-sun"></i> El Tiempo Actual</h3>
    <div class="weather-locations">
        <div class="weather-location" id="weather-figueres">
            <h4><i class="fas fa-map-marker-alt"></i> Figueres</h4>
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> Cargando datos del tiempo...
            </div>
        </div>
        <div class="weather-location" id="weather-cadaques">
            <h4><i class="fas fa-map-marker-alt"></i> Cadaqués</h4>
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> Cargando datos del tiempo...
            </div>
        </div>
    </div>
    <div class="last-updated" id="last-updated"></div>
</div>

<style>
/* CSS para el widget del tiempo */
.weather-widget {
    background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    border-radius: 20px;
    padding: 2rem;
    margin: 2rem 0;
    color: white;
    box-shadow: 0 15px 35px rgba(116, 185, 255, 0.3);
}

.weather-widget h3 {
    text-align: center;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.weather-locations {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.weather-location {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 1.5rem;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.weather-location:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.weather-location h4 {
    font-size: 1.3rem;
    margin-bottom: 1rem;
    color: #fff;
}

.weather-main {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.weather-icon {
    font-size: 3rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.weather-temp {
    font-size: 2.5rem;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.weather-condition {
    font-size: 1.1rem;
    margin-bottom: 1rem;
    opacity: 0.9;
}

.weather-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    font-size: 0.9rem;
}

.weather-detail {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.weather-detail i {
    opacity: 0.8;
}

.loading {
    text-align: center;
    padding: 2rem;
    opacity: 0.7;
}

.error {
    background: linear-gradient(135deg, #ff7675 0%, #d63031 100%);
    color: white;
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
    margin: 1rem 0;
}

.last-updated {
    text-align: center;
    font-size: 0.8rem;
    opacity: 0.7;
    margin-top: 1rem;
}

@media (max-width: 768px) {
    .weather-locations {
        grid-template-columns: 1fr;
    }
    
    .weather-main {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .weather-details {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
class WeatherPlugin {
    constructor() {
        this.apiKey = 'TU_API_KEY_AQUI'; // Reemplaza con tu API key de OpenWeatherMap
        this.locations = [
            { id: 'weather-figueres', name: 'Figueres', lat: 42.2677, lon: 2.9611 },
            { id: 'weather-cadaques', name: 'Cadaqués', lat: 42.2889, lon: 3.2778 }
        ];
        this.baseUrl = 'https://api.openweathermap.org/data/2.5/weather';
        this.init();
    }

    init() {
        this.loadWeatherData();
        // Actualizar cada 10 minutos
        setInterval(() => this.loadWeatherData(), 600000);
    }

    async loadWeatherData() {
        for (const location of this.locations) {
            try {
                await this.fetchWeatherData(location);
            } catch (error) {
                console.error(`Error loading weather for ${location.name}:`, error);
                this.displayError(location.id, `Error al cargar datos de ${location.name}`);
            }
        }
        this.updateLastUpdated();
    }

    async fetchWeatherData(location) {
        // Para demostración, usamos datos simulados realistas
        // En producción, descomenta la línea de abajo y usa la API real
        // const response = await fetch(`${this.baseUrl}?lat=${location.lat}&lon=${location.lon}&appid=${this.apiKey}&units=metric&lang=es`);
        
        // Simulación de datos del tiempo realistas para la Costa Brava en julio
        const simulatedData = this.generateRealisticWeatherData(location);
        this.displayWeatherData(location.id, simulatedData);
    }

    generateRealisticWeatherData(location) {
        const conditions = [
            { main: 'Clear', description: 'Despejado', icon: 'fas fa-sun', temp: 28 + Math.random() * 4 },
            { main: 'Clouds', description: 'Parcialmente nublado', icon: 'fas fa-cloud-sun', temp: 25 + Math.random() * 5 },
            { main: 'Rain', description: 'Lluvia ligera', icon: 'fas fa-cloud-rain', temp: 22 + Math.random() * 3 }
        ];

        const condition = conditions[Math.floor(Math.random() * conditions.length)];
        const humidity = 50 + Math.random() * 30;
        const windSpeed = 5 + Math.random() * 15;
        const pressure = 1010 + Math.random() * 20;

        return {
            main: {
                temp: Math.round(condition.temp),
                humidity: Math.round(humidity),
                pressure: Math.round(pressure)
            },
            weather: [{
                main: condition.main,
                description: condition.description,
                icon: condition.icon
            }],
            wind: {
                speed: Math.round(windSpeed * 10) / 10
            }
        };
    }

    displayWeatherData(elementId, data) {
        const element = document.getElementById(elementId);
        if (!element) return;

        const weather = data.weather[0];
        const temp = Math.round(data.main.temp);
        const humidity = data.main.humidity;
        const windSpeed = data.wind.speed;
        const pressure = data.main.pressure;

        element.innerHTML = `
            <h4><i class="fas fa-map-marker-alt"></i> ${elementId.includes('figueres') ? 'Figueres' : 'Cadaqués'}</h4>
            <div class="weather-main">
                <i class="weather-icon ${weather.icon}"></i>
                <div class="weather-temp">${temp}°C</div>
            </div>
            <div class="weather-condition">${weather.description}</div>
            <div class="weather-details">
                <div class="weather-detail">
                    <i class="fas fa-tint"></i>
                    <span>Humedad: ${humidity}%</span>
                </div>
                <div class="weather-detail">
                    <i class="fas fa-wind"></i>
                    <span>Viento: ${windSpeed} m/s</span>
                </div>
                <div class="weather-detail">
                    <i class="fas fa-thermometer-half"></i>
                    <span>Presión: ${pressure} hPa</span>
                </div>
                <div class="weather-detail">
                    <i class="fas fa-eye"></i>
                    <span>Visibilidad: Buena</span>
                </div>
            </div>
        `;
    }

    displayError(elementId, message) {
        const element = document.getElementById(elementId);
        if (!element) return;

        element.innerHTML = `
            <div class="error">
                <i class="fas fa-exclamation-triangle"></i>
                <p>${message}</p>
                <button onclick="weatherPlugin.loadWeatherData()" style="margin-top: 10px; padding: 5px 10px; background: rgba(255,255,255,0.2); border: none; border-radius: 5px; color: white; cursor: pointer;">
                    <i class="fas fa-sync-alt"></i> Reintentar
                </button>
            </div>
        `;
    }

    updateLastUpdated() {
        const lastUpdatedElement = document.getElementById('last-updated');
        if (lastUpdatedElement) {
            const now = new Date();
            const timeString = now.toLocaleString('es-ES', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            lastUpdatedElement.textContent = `Última actualización: ${timeString}`;
        }
    }
}

// Inicializar el plugin cuando se carga la página
document.addEventListener('DOMContentLoaded', function() {
    window.weatherPlugin = new WeatherPlugin();
});
</script>

